<html>

<head>
   <link href="https://unpkg.com/tabulator-tables@4.9.3/dist/css/tabulator.min.css" rel="stylesheet">
   <script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.9.3/dist/js/tabulator.min.js"></script>
   <script src="https://wow.zamimg.com/widgets/power.js"></script>
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<script>
   function openTab(tabName) {
      var i;
      var x = document.getElementsByClassName("tab");
      for (i = 0; i < x.length; i++) {
         x[i].style.display = "none";
      }
      document.getElementById(tabName).style.display = "block";
   }
</script>
<script>var whTooltips = { colorLinks: true, iconizeLinks: true, renameLinks: true };</script>


<br /><br />
<div>
   <button onclick="openTab('DKP')">DKP Table</button>
   <button onclick="openTab('DKPHistory')">DKP History</button>
   <button onclick="openTab('LootHistory')">Loot History</button>
</div>
<br /><br />
<div id="DKP" class="tab">
   <div id="dkp_table"></div>
</div>
<div id="DKPHistory" class="tab">
   <div id="DKPHistory_table"></div>
</div>
<div id="DKP" class="tab">
   <div id="LootHistory_table"></div>
</div>
<script>
   //var csv is the CSV file with headers
   function csvJSON(csv) {

      var lines = csv.split("\n");

      var result = [];

      // NOTE: If your columns contain commas in their values, you'll need
      // to deal with those before doing the next step 
      // (you might convert them to &&& or something, then covert them back later)
      // jsfiddle showing the issue https://jsfiddle.net/
      var headers = lines[0].split(",");

      for (var i = 1; i < lines.length; i++) {

         var obj = {};
         var currentline = lines[i].split(",");

         for (var j = 0; j < headers.length; j++) {
            obj[headers[j]] = currentline[j];
         }

         result.push(obj);

      }

      //return result; //JavaScript object
      return result; //JSON
   }

   jQuery.get('https://knoxz.github.io/dkp.csv', function (data) {
      let dkp_data = csvJSON(data);
      console.log(dkp_data);
      dkp_table.setData(dkp_data);
   });
   jQuery.get('https://knoxz.github.io/dkp.txt', function (data) {
      let dkp_data = csvJSON(data);
      console.log(dkp_data);
      dkp_table.setData(dkp_data);
   });
   jQuery.get('https://knoxz.github.io/dkp.txt', function (data) {
      let dkp_data = csvJSON(data);
      console.log(dkp_data);
      dkp_table.setData(dkp_data);
   });

   var dkp_table = new Tabulator("#dkp_table", {
      data: dkp_data,
      layout: "fitColumns", //fit columns to width of table (optional)
      columns: [ //Define Table Columns
         // player,class,DKP,previousDKP,lifetimeGained,lifetimeSpent
         { title: "Player", field: "player" },
         { title: "class", field: "class" },
         { title: "DKP", field: "DKP" },
         { title: "previousDKP", field: "previousDKP" },
         { title: "lifetimeGained", field: "lifetimeGained" },
         { title: "lifetimeSpent", field: "lifetimeSpent" },
      ]
   });

   var DKPHistory_table = new Tabulator("#DKPHistory_table", {
      layout: "fitColumns", //fit columns to width of table (optional)
      columns: [ //Define Table Columns
         // player,class,DKP,previousDKP,lifetimeGained,lifetimeSpent
         { title: "Player", field: "player" },
         { title: "DKP", field: "DKP" },
         { title: "date", field: "date" },
         { title: "reason", field: "reason" }
      ]
   });

   var LootHistory_table = new Tabulator("#LootHistory_table", {
      layout: "fitColumns", //fit columns to width of table (optional)
      columns: [ //Define Table Columns
         // player,class,DKP,previousDKP,lifetimeGained,lifetimeSpent
         { title: "Player", field: "player" },
         { title: "itemName", field: "itemName" },
         { title: "itemNumber", field: "itemNumber" },
         { title: "zone", field: "zone" },
         { title: "boss", field: "boss" },
         { title: "date", field: "date" },
         { title: "cost", field: "cost" },
      ]
   });



</script>

</html>